'''
Created on 10 juil. 2018

@author: borettim
'''

from pytest import fixture

from areexsupport.sensors import sensors
from datetime import datetime
from pytz import timezone
import textwrap


@fixture(scope="session")
def simpleinput(tmpdir_factory):
    fn = tmpdir_factory.mktemp("data").join("input.txt")
    ffn = open(fn, 'w')
    try:
        ffn.write(textwrap.dedent('''
        Measurement log

        Sensors:
        
        Column    Sensor    Unit
        1    Maquette Partie Haute - V    V
        2    Maquette Partie Haute - RH    RH%
        3    Maquette Partie Haute - T    °C
        4    Extérieur    °C
        
        Start date: 14.07.2018
        End date: 14.07.2018
        
        Time    1    2    3    4
        14.07.2018 00:00:39     3.2        23.4    
        14.07.2018 00:00:40                25.2
        14.07.2018 00:01:07        48.2        
        14.07.2018 00:01:29            23.4    
        14.07.2018 00:01:31                25.2
        14.07.2018 00:01:47        48.2        
        14.07.2018 00:02:09                25.2
        14.07.2018 00:02:33            23.4    
        14.07.2018 00:03:00                25.2
        14.07.2018 00:03:04        48.2        
        14.07.2018 00:03:44            23.4    
        14.07.2018 00:03:46                25.2
        14.07.2018 00:04:40        48.2        
        14.07.2018 00:04:52                25.1
        14.07.2018 00:05:27            23.4    
        14.07.2018 00:05:58        48.2        
        14.07.2018 00:06:04                25.2
        14.07.2018 00:06:21            23.4    
        14.07.2018 00:06:40        48.2        
        14.07.2018 00:07:13                25.1
        14.07.2018 00:07:25            23.3    
        14.07.2018 00:07:55        48.2        
        14.07.2018 00:08:17            23.3    
        14.07.2018 00:08:22                25.1
        14.07.2018 00:08:35        48.2        
        14.07.2018 00:09:22            23.3    
        14.07.2018 00:09:33                25.1
        14.07.2018 00:10:15        48.2        
        14.07.2018 00:10:35                25.1
        14.07.2018 00:11:01            23.3    
        14.07.2018 00:11:12                25.1
        14.07.2018 00:11:51        48.2        
        14.07.2018 00:12:23            23.3    
        14.07.2018 00:12:27                25.1
        14.07.2018 00:12:46        48.2        
        14.07.2018 00:13:29                25.1
        14.07.2018 00:13:30            23.3    
        14.07.2018 00:13:59        48.2        
        14.07.2018 00:14:01                25.1
        14.07.2018 00:14:40            23.3    
        14.07.2018 00:15:13                25.1
        14.07.2018 00:15:36        48.2        
        14.07.2018 00:16:01                25.0
        14.07.2018 00:16:24            23.4    
        14.07.2018 00:17:03                25.0
        14.07.2018 00:17:12        48.2        
        14.07.2018 00:17:42                25.0
        14.07.2018 00:17:44            23.4    
        14.07.2018 00:18:07        48.2        
        14.07.2018 00:18:26            23.4    
        14.07.2018 00:18:33                25.0
        14.07.2018 00:18:43        48.2        
        14.07.2018 00:19:27     3.2            
        14.07.2018 00:19:28            23.4    
        14.07.2018 00:19:47                25.0
        14.07.2018 00:19:57        48.2        
        14.07.2018 00:20:37            23.4    
        14.07.2018 00:20:41                25.0
        14.07.2018 00:21:04        48.2        
        14.07.2018 00:21:25            23.4    
        14.07.2018 00:21:43        48.2        
        14.07.2018 00:21:52                24.9
        14.07.2018 00:22:28            23.4    24.9
        14.07.2018 00:23:05                24.9
        14.07.2018 00:23:56            23.4    
        14.07.2018 00:24:18                24.9
        14.07.2018 00:24:34        48.2        
        14.07.2018 00:25:00            23.4    
        14.07.2018 00:25:33                24.9
        14.07.2018 00:25:40        48.2        
        14.07.2018 00:26:36            23.4    
        14.07.2018 00:27:16                24.9
        14.07.2018 00:27:24        48.2        
        14.07.2018 00:28:14            23.4    24.9
        14.07.2018 00:29:04        48.2        
        14.07.2018 00:29:21                24.8
        14.07.2018 00:29:37            23.4    
        14.07.2018 00:29:55                24.8
        14.07.2018 00:30:01        48.2        
        14.07.2018 00:30:44            23.4    
        14.07.2018 00:30:47                24.9
        14.07.2018 00:31:36        48.2        
        14.07.2018 00:31:37                24.8
        14.07.2018 00:32:24            23.4    
        14.07.2018 00:32:43                24.8
        14.07.2018 00:33:13        48.2        
        14.07.2018 00:33:31                24.8
        14.07.2018 00:33:46            23.4    
        14.07.2018 00:34:07                24.8
        14.07.2018 00:34:22        48.2        
        14.07.2018 00:35:07                24.9
        14.07.2018 00:35:17            23.3    
        14.07.2018 00:35:51        48.2        
        14.07.2018 00:36:00                24.8
        14.07.2018 00:36:16            23.4    
        14.07.2018 00:36:32                24.8
        14.07.2018 00:36:59        48.2        
        14.07.2018 00:37:27            23.4    
        14.07.2018 00:37:32                24.8
        14.07.2018 00:38:08        48.2        
        14.07.2018 00:38:26                24.8
        14.07.2018 00:38:36            23.4    
        14.07.2018 00:39:03                24.8
        14.07.2018 00:39:15        48.2        
        14.07.2018 00:39:39                24.8
        14.07.2018 00:40:11     3.2        23.4    
        14.07.2018 00:40:22                24.8
        14.07.2018 00:40:59        48.2        
        14.07.2018 00:41:05                24.8
        14.07.2018 00:41:30            23.4    
        14.07.2018 00:41:55                24.8
        14.07.2018 00:42:07        48.2        
        14.07.2018 00:42:33            23.4    
        14.07.2018 00:42:51                24.8
        14.07.2018 00:43:12        48.2        
        14.07.2018 00:44:00                24.8
        14.07.2018 00:44:09            23.4    
        14.07.2018 00:44:40                24.8
        14.07.2018 00:44:44        48.2        
        14.07.2018 00:45:22            23.4    
        14.07.2018 00:45:46                24.8
        14.07.2018 00:46:16        48.2        
        14.07.2018 00:46:39                24.8
        14.07.2018 00:47:04            23.4    
        14.07.2018 00:47:36        48.2        
        14.07.2018 00:47:39                24.8
        14.07.2018 00:47:59            23.4    
        14.07.2018 00:48:42        48.2        
        14.07.2018 00:48:45                24.8
        14.07.2018 00:49:34            23.4    
        14.07.2018 00:49:50                24.7
        14.07.2018 00:50:07        48.2        
        14.07.2018 00:50:43                24.7
        14.07.2018 00:50:45            23.4    
        14.07.2018 00:51:11        48.2        
        14.07.2018 00:51:32            23.4    
        14.07.2018 00:51:50                24.7
        14.07.2018 00:52:13        48.2        
        14.07.2018 00:52:30                24.7
        14.07.2018 00:53:06            23.4    
        14.07.2018 00:53:27                24.8
        14.07.2018 00:53:40        48.2        
        14.07.2018 00:54:14                24.7
        14.07.2018 00:54:17            23.4    
        14.07.2018 00:55:12        48.2        
        14.07.2018 00:55:16                24.7
        14.07.2018 00:55:47            23.4    
        14.07.2018 00:56:24        48.2        
        14.07.2018 00:56:29                24.7
        14.07.2018 00:56:50            23.4    
        14.07.2018 00:57:10        48.2        
        14.07.2018 00:57:27            23.3    
        14.07.2018 00:57:39                24.7
        14.07.2018 00:58:13        48.2        
        14.07.2018 00:58:42                24.7
        14.07.2018 00:58:43            23.4    
        14.07.2018 00:59:06        48.2        
        14.07.2018 00:59:26                24.7
        14.07.2018 00:59:47     3.2        23.4    
        14.07.2018 00:59:57                24.7
        14.07.2018 01:00:40        48.2        
        14.07.2018 01:00:47                24.6
        14.07.2018 01:01:27            23.4    
        14.07.2018 01:01:31                24.7
        14.07.2018 01:01:58        48.2        
        14.07.2018 01:02:35            23.4    
        14.07.2018 01:02:43                24.7
        14.07.2018 01:03:30        48.2        
        14.07.2018 01:03:36                24.7
        14.07.2018 01:04:05            23.4    
        14.07.2018 01:04:11                24.7
        14.07.2018 01:04:42        48.2        
        14.07.2018 01:05:18                24.7
        14.07.2018 01:05:36            23.3    
        14.07.2018 01:05:50                24.6
        14.07.2018 01:06:11        48.2        
        14.07.2018 01:06:35            23.4    
        14.07.2018 01:06:40                24.6
        14.07.2018 01:06:55        48.2        
        14.07.2018 01:07:12            23.4    
        14.07.2018 01:07:35                24.6
        14.07.2018 01:07:56        48.2        
        14.07.2018 01:08:21                24.6
        14.07.2018 01:08:50            23.4    
        14.07.2018 01:09:10                24.6
        14.07.2018 01:09:37        48.2        
        14.07.2018 01:10:07            23.4    
        14.07.2018 01:10:15                24.6
        14.07.2018 01:10:44        48.2        
        14.07.2018 01:10:49                24.6
        14.07.2018 01:11:09            23.3    
        14.07.2018 01:11:20                24.6
        14.07.2018 01:11:29        48.2        
        14.07.2018 01:12:08                24.6
        14.07.2018 01:12:11            23.4    
        14.07.2018 01:12:39        48.2        
        14.07.2018 01:12:41                24.6
        14.07.2018 01:13:01            23.4    
        14.07.2018 01:13:40                24.6
        14.07.2018 01:13:41        48.2        
        14.07.2018 01:14:09            23.4    
        14.07.2018 01:14:31        48.2        
        14.07.2018 01:14:49            23.3    
        14.07.2018 01:14:54                24.6
        14.07.2018 01:15:05        48.2        
        14.07.2018 01:15:21            23.4    
        14.07.2018 01:15:41                24.5
        14.07.2018 01:16:05        48.2        
        14.07.2018 01:16:25                24.5
        14.07.2018 01:16:35            23.4    
        14.07.2018 01:17:02                24.6
        14.07.2018 01:17:15        48.2        
        14.07.2018 01:17:47                24.5
        14.07.2018 01:18:10     3.2            
        14.07.2018 01:18:11            23.4    
        14.07.2018 01:18:19                24.6
        14.07.2018 01:18:46        48.2        
        14.07.2018 01:18:54                24.5
        14.07.2018 01:19:11            23.4    
        14.07.2018 01:19:31        48.2        
        14.07.2018 01:19:34                24.5
        14.07.2018 01:20:16            23.4    
        14.07.2018 01:20:19                24.6
        14.07.2018 01:21:05                24.5
        14.07.2018 01:21:09        48.2        
        14.07.2018 01:21:55            23.4    
        14.07.2018 01:22:26        48.2        
        14.07.2018 01:22:46                24.5
        14.07.2018 01:22:49            23.4    
        14.07.2018 01:23:07        48.2        
        14.07.2018 01:23:24            23.4    
        14.07.2018 01:23:40        48.2        
        14.07.2018 01:23:47                24.4
        14.07.2018 01:23:55            23.4    
        14.07.2018 01:24:36                24.4
        14.07.2018 01:24:39        48.2        
        14.07.2018 01:25:09                24.4
        14.07.2018 01:25:33            23.3    
        14.07.2018 01:26:08        48.2        
        14.07.2018 01:26:16                24.4
        14.07.2018 01:26:46            23.4    
        14.07.2018 01:27:09                24.4
        14.07.2018 01:27:41        48.2        
        14.07.2018 01:28:29            23.4    
        14.07.2018 01:28:43                24.3
        14.07.2018 01:29:22                24.4
        14.07.2018 01:29:50            23.4    
        14.07.2018 01:30:14                24.4
        14.07.2018 01:30:26        48.2        
        14.07.2018 01:30:51            23.4    
        14.07.2018 01:31:06                24.3
        14.07.2018 01:31:11        48.2        
        14.07.2018 01:31:29            23.4    
        14.07.2018 01:31:45        48.2        
        14.07.2018 01:31:51                24.4
        14.07.2018 01:32:00            23.3    
        14.07.2018 01:32:15        48.2        
        14.07.2018 01:32:30            23.3    
        14.07.2018 01:32:59                24.3
        14.07.2018 01:33:15        48.2        
        14.07.2018 01:33:39                24.3
        14.07.2018 01:33:44            23.3    
        14.07.2018 01:34:06        48.2        
        14.07.2018 01:34:48     3.2        23.3    ''').replace('    ', '\t'))
    finally:
        ffn.close()
    return fn


def testSensorsInitOnlyMandataParameter(simpleinput):
    d = sensors(simpleinput)
    assert 'Extérieur' in d.keys()
    assert 'Maquette Partie Haute - RH' in d.keys()
    assert 'Maquette Partie Haute - T' in d.keys()
    assert 'Maquette Partie Haute - V' in d.keys()
    assert len(d.groups) == 1
    assert 'default' in d.groups
